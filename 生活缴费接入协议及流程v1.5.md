>   生活缴费接入协议及流程文档V1.4

版本记录

| **日期**   | **版本** | **备注**                                                                                         |
|------------|----------|--------------------------------------------------------------------------------------------------|
| 2015-10-20 | V0.1版本 | 初始版本                                                                                         |
| 2015-10-29 | V0.2版本 | 报文头增加商户号字段，规范缴费结果回调报文                                                       |
| 2015-11-24 | V0.3版本 | 修改退款文件格式                                                                                 |
| 2016-05-16 | V0.4版本 | 增加返回值模版                                                                                   |
| 2016-08-20 | V0.5版本 | 补充标准协议接入流程，添加销帐结果查询接口，添加验收标准和流程                                   |
| 2017-10-20 | V0.6版本 | 增加委托代扣相关接口的说明                                                                       |
| 2018-02-26 | V0.7版本 | 调整代扣推送接收文件格式；细化接入流程                                                           |
| 2018-07-10 | V0.8版本 | 更新沙箱环境链接地址；更改查询接口extend-\>extends；                                             |
| 2018-12-20 | V0.9版本 | 销帐应答报文增加预留字段                                                                         |
| 2019-03-15 | V1.0版本 | 错误码修改                                                                                       |
| 2019-04-17 | V1.1版本 | 增加退款接口（银行渠道断直连专用）                                                               |
| 2019-04-19 | V1.2版本 | 修改退款接口（银行渠道断直连专用），新增状态通知接口                                             |
| 2019-04-23 | V1.3版本 | 修改退款接口（银行渠道断直连专用），删除子商户号、渠道商商户号请求参数                           |
| 2019-04-26 | V1.4版本 | 修改退款接口（银行渠道断直连专用），删除退款资金来源请求参数，删除响应包体，响应头增加交易流水号 |
| 2019-05-20 | V1.5版本 | 增加退款接口（银行渠道断直连专用）返回码说明，增加退款接口URL                                    |

**目录**

[一、 系统说明 3](#系统说明)

[1.1、术语 3](#术语)

[1.2、交互逻辑 3](#交互逻辑)

[二、 报文说明 4](#报文说明)

[2.1、通讯模式 4](#通讯模式)

[2.2、报文编码 4](#报文编码)

[2.3、报文格式 4](#报文格式)

[三、 交易接口 7](#交易接口)

[3.1、交易接口列表 7](#交易接口列表)

[3.2、查询缴费单请求 7](#查询缴费单请求)

[3.3、账单详情通知接口 9](#账单详情通知接口)

[3.4、发起缴费 13](#发起缴费)

[3.5、缴费结果回调通知 16](#缴费结果回调通知)

[3.6、缴费结果查询接口 18](#缴费结果查询接口)

[3.7、公共事业单位维护通知 21](#公共事业单位维护通知)

[3.8、申请退款（银行渠道断直连专用） 22](#申请退款银行渠道断直连专用)

[3.9、状态通知 24](#状态通知)

[四、 委托代扣 27](#委托代扣)

[4.1、委托代扣交互逻辑 27](#委托代扣交互逻辑)

[4.2、委托代扣接口列表 28](#委托代扣接口列表)

[4.3、查询用户信息接口 28](#查询用户信息接口)

[4.4、签约接口 31](#签约接口)

[4.5、代扣配置接口 34](#代扣配置接口)

[4.6、解约接口（微信侧主调） 37](#解约接口微信侧主调)

[4.7、解约接口（渠道商主调） 39](#解约接口渠道商主调)

[4.8、账单通知文件 42](#账单通知文件)

[4.9、订单支付文件 43](#订单支付文件)

[五、 错误码列表 43](#错误码列表)

[六、 业务类型列表 46](#业务类型列表)

[七、 接入流程 46](#接入流程)

[7.1. 通信方式评估 46](#通信方式评估)

[7.2. 接口开发 46](#接口开发)

[7.3. 提供渠道及缴费单位配置信息 47](#提供渠道及缴费单位配置信息)

[7.4. 接口自助调试 48](#接口自助调试)

[7.5. 测试环境接口联调 48](#测试环境接口联调)

[7.6. 沙箱环境测试 48](#微信生活缴费测试环境申请退款接口银行渠道断直连专用url)

[7.7. 通知上线 49](#通知上线)

[7.8. 对账结算 49](#对账结算)

[7.9. 退款 49](#退款)

[八、 验收流程 50](#验收流程)

[8.1、接口验证及测试环境联调 50](#接口验证及测试环境联调)

[8.2、沙箱环境验证 50](#沙箱环境验证)

[8.3、正式环境上线 50](#正式环境上线)

系统说明
========

1.1、术语
---------

>   1、渠道商：指接入微信生活缴费平台、对口公共事业单位能完成相关业务代缴费的第三方机构。

>   2、缴费机构：指能完成缴费的事业单位，如自来水公司、电力公司等。

1.2、交互逻辑
-------------

![D:\\工作资料\\svrkit开发文档\\生活缴费\\统一协议\\流程指示.jpg](media/f42c26bf247f54239a6e89ab3827835d.jpg)

报文说明
========

2.1、通讯模式
-------------

生活缴费平台与渠道平台使用HTTPS协议进行通讯，提交方式为POST。接口参数在HTTPS包体中采用XML方式传递。

2.2、报文编码
-------------

报文中可能有汉字，需要对报文进行编码才能正常显示。在调用渠道机构接口时，微信侧采用UTF-8编码生成XML报文和签名。

2.3、报文格式
-------------

微信与渠道进行通信时，需对数据进行签名验证。数据通信格式如下：

| 签名+xml数据报，其中签名加密方式为SHA1或SHA256，加密串字母为大写 |
|------------------------------------------------------------------|


目前系统支持SHA1和SHA256两种签名方式，优先推荐使用SHA256。如有特殊情况必须指定其他签名算法，接入时请提前说明。

**报文范例**

请求：

| 670B2FA77740D3EA35DB20AAEC42D88FEDDAD20F\<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\> \<version\>1.0.1\</version\> \<trancode\>query\</trancode\> \<transeqnum\>305912304\</transeqnum\> \<merchantid\>1269692401\</merchantid\> \</head\> \<info\> \<bill_key\>007226\</bill_key\> \<company_id\>595100101\</company_id\> \<begin_num\>1\</begin_num\> \<query_num\>1\</query_num\> \</info\> \</wxlifepay\> |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|


返回：

| 8EC63FDB7EA0484E457E25E41FB667BE028CDC53\<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\> \<version\>1.0.1\</version\> \<trancode\>query\</trancode\> \<transeqnum\>305912304\</transeqnum\> \<merchantid\>1269692401\</merchantid\> \<ret_code\>0\</ret_code\> \<err_msg\>操作成功\</err_msg\> \</head\> \<info\> \<bill_key\>007226\</bill_key\> \<company_id\>595100101\</company_id\> \<total_num\>1\</total_num\> \<data\> \<customer_name\>文榜\</customer_name\> \<balance\>0\</balance\> \<pay_amount\>0\</pay_amount\> \<begin_date\>\</begin_date\> \<end_date\>\</end_date\> \<attach\>8a7ba6b65412a9da0154141246b100d3\</attach\> \</data\>\</info\> \</wxlifepay\> |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|


字段说明：

1.  报文起始字符为签名字段，签名串为大写字母。

| 以SHA1签名方式举例： Str1 = Sha1（xml数据包+密钥），密钥拼接在xml数据包后面参与签名 签名串= toupper(Str1)，转换为大写字符。 通信数据报：签名串+xml数据包。可参考上述报文范例。 **签名示例** Xml数据包： \<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\>\<version\>1.0.1\</version\>\<trancode\>query\</trancode\>\<transeqnum\>305912304\</transeqnum\>\<merchantid\>1269692401\</merchantid\>\</head\> \<info\> \<bill_key\>007226\</bill_key\>\<company_id\>595100101\</company_id\>\<begin_num\>1\</begin_num\>\<query_num\>1\</query_num\> \</info\>\</wxlifepay\> 密钥：abcdefghj123456xyz Sha1签名之后签名（字母转化为大写）：EFA8530B85CBDB4399F128419C4A5F11A89D3AFE 通信数据包： EFA8530B85CBDB4399F128419C4A5F11A89D3AFE\<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\>\<version\>1.0.1\</version\>\<trancode\>query\</trancode\>\<transeqnum\>305912304\</transeqnum\>\<merchantid\>1269692401\</merchantid\>\</head\> \<info\> \<bill_key\>007226\</bill_key\>\<company_id\>595100101\</company_id\>\<begin_num\>1\</begin_num\>\<query_num\>1\</query_num\> \</info\>\</wxlifepay\> |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|


2.  head为报文头节点。

3.  version为协议版本号，固定填入“1.0.1”。

4.  trancode为接口类型，具体定义参照交易接口。

5.  transeqnum终端流水号，由微信产生，用作跟踪每笔交易的请求和应答报文，同一天内该值不重复。

6.  merchantid渠道商的商户号，由微信产生。

7.  ret_code为错误码，具体定义参照第四部分错误码列表。

8.  err_msg为处理返回语，用于用户页面提示。

9.  info为报文体节点，根据接口填入对应业务数据。

交易接口
========

3.1、交易接口列表
-----------------

渠道机构需在接口url中，使用不同应用名作为区分。

| 序号 | 交易名称         | 交易用途                                     | 交易频率 | 接口类型标识   | 交易发起方 |
|------|------------------|----------------------------------------------|----------|----------------|------------|
|      | 查询缴费单请求   | 通过此接口向第三方渠道商发起账单信息查询请求 | 实时发起 | query          | 微信       |
|      | 账单详情通知接口 | 渠道方从事业单位查到账单后通知微信           | 实时发起 | querycallback  | 渠道方     |
|      | 缴费单销账       | 通过此接口向第三方渠道商发起账单销账         | 实时发起 | charge         | 微信       |
|      | 缴费单销账回调   | 通过此接口第三方渠道商通知微信账单销账结果   | 实时发起 | chargecallback | 渠道商     |
|      | 销帐结果查询接口 | 对未收到销帐回调通知的缴费单进行销帐结果查询 | 实时发起 | confirm        | 微信       |

3.2、查询缴费单请求
-------------------

应用场景：

用户输入用户号之后，由微信侧向渠道方发起账单详情查询请求，渠道方收到查询请求后进行数据合法行校验（签名及必填字段等校验），数据合法且可以受理该查询请求后立即返回给微信，表明渠道方可以受理该查询请求；该接口由渠道方提供。（具体账单详情通过3.3、账单详情通知接口异步通知给微信生活缴费）

请求参数：

| 变量名     | 字段名     | 长度     | 约束条件 | 说明                  |
|------------|------------|----------|----------|-----------------------|
| bill_key   | 机表号     | char(35) | 必填     | 缴费单标识号          |
| transeqnum | 交易流水号 | char(20) | 必填     | 唯一标记一笔查询      |
| company_id | 机构代号   | char(30) | 必填     | 收费单位唯一标识号    |
| begin_num  | 起始笔数   | num(3)   | 选填     | 查询起始笔数，从1开始 |
| query_num  | 查询笔数   | num(3)   | 选填     | 查询笔数              |
| trancode   | 交易码     | char(15) | 必填     | 查询交易码为query     |
| extends1   | 扩展字段1  | char(32) | 选填     | 用户页面其他输入要素  |
| extends2   | 扩展字段2  | char(32) | 选填     | 查询页面其他输入要素  |
| extends3   | 扩展字段3  | char(32) | 选填     | 查询页面其他输入要素  |
| extends4   | 扩展字段4  | char(32) | 选填     | 查询页面其他输入要素  |

举例如下：

| \<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\> |
|-----------------------------------------------------------------|


>   \<version\>1.0.1\</version\>

>   \<trancode\> query \</trancode \>

>   \<transeqnum\>10000001\</transeqnum\>

>   \<merchantid\>1234567\</merchantid\>

>   \</head\>

>   \<info\>

>   \<bill_key\>12345678\</bill_key\>

>   \<company_id\>12345\</company_id\>

>   \<begin_num\>1\</begin_num\>

>   \<query_num\>1\</query_num\>

>   \<extends1\>extends1\</extends1\>

>   \<extends2\>extends2\</extends2\>

>   \<extends3\>extends3\</extends3\>

>   \<extends4\>extends4\</extends4\>

>   \</info\>

\</wxlifepay\>

注：发起请求数据会进行签名。参见签名规则部分说明。

返回结果：

| 变量名     | 字段名       | 长度     | 约束条件 | 说明                                           |
|------------|--------------|----------|----------|------------------------------------------------|
| ret_code   | 查询返回码   | char(10) | 必填     | 返回查询结果，错误码类型参考查询接口错误码列表 |
| err_msg    | 返回提示信息 | char(20) | 必填     | 返回结果提示信息                               |
| transeqnum | 交易流水号   | char(20) | 必填     | 唯一标记一笔查询                               |
| merchantid | 商户号       | char(32) | 必填     | 商户号                                         |
| trancode   | 交易码       | char(15) | 必填     | 查询交易码为query                              |

渠道方收到请求后，如果判断可以受理，立刻返回给微信。

报文样例：

| \<?xml version="1.0" encoding="UTF-8"?\> |
|------------------------------------------|


>   \<wxlifepay\>

>   \<head\>

>   \<version\>1.0.1\</version\>

>   \<trancode\>query\</trancode\>

>   \<transeqnum\>10000001\</transeqnum\>

>   \<merchantid\>1234567\</merchantid\>

>   \<ret_code\>0\</ret_code\>

>   \<err_msg\>success\</err_msg\>

>   \</head\>

>   \<info\>

>   \<bill_key\>12345678\</bill_key\>

>   \<company_id\>12345\</company_id\>

>   \</info\>

>   \</wxlifepay\>

3.3、账单详情通知接口
---------------------

应用场景：

渠道方从事业单位查询到账单之后，通过该接口通知给微信生活缴费。

请求参数:

| 变量名                                                                              | 字段名       | 长度       | 约束条件 | 说明                                           |
|-------------------------------------------------------------------------------------|--------------|------------|----------|------------------------------------------------|
| ret_code                                                                            | 查询返回码   | char(10)   | 必填     | 返回查询结果，错误码类型参加查询接口错误码列表 |
| err_msg                                                                             | 返回提示信息 | char(20)   | 必填     | 返回结果提示信息                               |
| transeqnum                                                                          | 交易流水号   | char(20)   | 必填     | 唯一标记一笔查询                               |
| merchantid                                                                          | 商户号       | char(32)   | 必填     | 商户号                                         |
| trancode                                                                            | 交易码       | char(15)   | 必填     | 查询交易码为querycallback                      |
| 以下字段在查询成功，ret_code为0时，必需返回的账单信息，其中data包含信息，可以为多组 |              |            |          |                                                |
| bill_key                                                                            | 机表号       | char(35)   | 必填     | 缴费单标识号                                   |
| company_id                                                                          | 机构代号     | char(30)   | 必填     | 收费单位唯一标识号                             |
| total_num                                                                           | 总笔数       | char(3)    | 必填     | 返回总查询笔数                                 |
| customer_name                                                                       | 客户姓名     | char(100)  | 必填     |                                                |
| balance                                                                             | 余额         | num(16)    | 必填     | 单位：分                                       |
| pay_amount                                                                          | 应缴金额     | num(16)    | 必填     | 单位：分                                       |
| show_value                                                                          | 展示信息     | char(16)   | 选填     | 100元/xxx套餐等                                |
| begin_date                                                                          | 起始日期     | char(10)   | 选填     |                                                |
| end_date                                                                            | 截至日期     | char(10)   | 选填     |                                                |
| customer_addr                                                                       | 用电地址     | Char(1024) | 选填     | 用电地址                                       |
| attach                                                                              | 备用字段     | char(1024) | 选填     | 预留数据域，用于携带需要通过缴费接口透传的信息 |
| attach1                                                                             | 备用字段     | char(1024) | 选填     | 预留数据域，用于携带需要通过缴费接口透传的信息 |
| field1                                                                              | 备用字段     | Char(128)  | 选填     | 用于多要素展示信息                             |
| field2                                                                              | 备用字段     | Char(128)  | 选填     | 用于多要素展示信息                             |
| field3                                                                              | 备用字段     | Char(128)  | 选填     | 用于多要素展示信息                             |
| field4                                                                              | 备用字段     | Char(128)  | 选填     | 用于多要素展示信息                             |
| field5                                                                              | 备用字段     | Char(128)  | 选填     | 用于多要素展示信息                             |

查询支持多账期，具体账单信息体在标签\<data\>\</data\>中包含，若为多账期，账单信息为多组。

报文样例：

| \<?xml version="1.0" encoding="UTF-8"?\> |
|------------------------------------------|


>   \<wxlifepay\>

>   \<head\>

>   \<version\>1.0.1\</version\>

>   \<trancode\>querycallback\</trancode\>

>   \<transeqnum\>10000001\</transeqnum\>

>   \<merchantid\>1234567\</merchantid\>

>   \<ret_code\>0\</ret_code\>

>   \<err_msg\>success\</err_msg\>

>   \</head\>

>   \<info\>

>   \<bill_key\>12345678\</bill_key\>

>   \<company_id\>12345\</company_id\>

>   \<total_num\>2\</total_num\>

>   \<data\>

>   \<customer_name\>李四\</customer_name\>

>   \<balance\>0\</balance\>

>   \<pay_amount\>199\</pay_amount\>

>   \<begin_date\>201501\</begin_date\>

>   \<end_date\>201501\</end_date\>

>   \<attach\> attach \</attach\>

>   \<attach1\> attach \</attach1\>

>   \<field1\> field1 \</field1\>

>   \< field 2\> field2 \</ field 2\>

>   \< field 3\> field3 \</ field 3\>

>   \< field 4\> field4\</field 4\>

>   \< field 5\> field5 \</ field 5\>

>   \<show_value\>200元\</show_value\>

>   \</data\>

>   \<data\>

>   \<customer_name\>李四\</customer_name\>

>   \<balance\>0\</balance\>

>   \<pay_amount\>99\</pay_amount\>

>   \<begin_date\>201502\</begin_date\>

>   \<end \_date\>201502\</end_date\>

>   \<attach\>abcd\</attach\>

>   \<attach1\>abcd\</attach1\>

>   \<show_value\>100元\</show_value\>

>   \</data\>

>   \<show_fields\>\<customer_addr\>深圳市10000号\</customer_addr\>\</show_fields\>

>   \</info\>

>   \</wxlifepay\>

返回结果：

| 变量名                 | 字段名     | 长度     | 约束条件 | 说明          |
|------------------------|------------|----------|----------|---------------|
| 消息头部               |            |          |          |               |
| version                | 版本号     | char(6)  | 必填     | 1.0.1         |
| trancode               | 交易码     | char(15) | 必填     | querycallback |
| transeqnum             | 交易流水号 | char(20) | 必填     | 交易流水号    |
| merchantid             | 商户号     | char(32) | 必填     | 商户号        |
| ret_code               | 返回值     | char(35) | 必填     | 回调返回码    |
| err_msg                | 返回信息   | char(20) | 选填     | 返回信息      |
| 销帐回调返回消息体为空 |            |          |          |               |

回调返回举例如下：

| \<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\> |
|-----------------------------------------------------------------|


>   \<version\>1.0.1\</version\>

>   \<trancode\>querycallback\</trancode\>

>   \<transeqnum\>10000001\</transeqnum\>

>   \<merchantid\>1234567\</merchantid\>

>   \<ret_code\>0\</ret_code\>

>   \<err_msg\>success\</err_msg\>

>   \</head\>

\</wxlifepay\>

3.4、发起缴费
-------------

应用场景：

此接口实现具体的缴费操作。用户支付成功之后，微信侧向渠道方发起销帐，渠道方收到销帐请求后立即给予应答，表明渠道方已收到销帐通知。

请求参数：

| 变量名         | 字段名         | 长度       | 约束条件 | 说明                                     |
|----------------|----------------|------------|----------|------------------------------------------|
| 头部信息       |                |            |          |                                          |
| version        | 版本号         | char(6)    | 必填     | 1.0.1                                    |
| trancode       | 交易码         | char(15)   | 必填     | charge                                   |
| transeqnum     | 交易流水号     | char(20)   | 必填     | 交易流水号                               |
| merchantid     | 商户号         | char(32)   | 必填     | 商户号                                   |
| 消息体         |                |            |          |                                          |
| bill_key       | 机表号         | char(35)   | 必填     | 缴费单标识号                             |
| company_id     | 机构代号       | char(30)   | 必填     | 收费单位唯一标识号                       |
| bill_no        | 缴费单的流水号 | char(16)   | 必填     | 微信生活缴费平台的业务流水号             |
| transaction_id | 微信支付订单号 | char(32)   | 必填     | 微信支付订单号                           |
| pay_date       | 缴费单支付日期 | char(14)   | 必填     | YYYYMMDDHHMMSS(支付缴费单时系统当前时间) |
| customer_name  | 客户姓名       | char(100)  | 必填     | 与查询报文应答包一致                     |
| pay_amount     | 缴费金额       | num(16)    | 必填     | (单位：分)                               |
| attach         | 备用字段       | char(1024) | 选填     | 透传从查询接口带入的信息                 |
| bill_month     | 账期字段       | Char(32)   | 必填     | YYYYMM格式，例如201606                   |

举例如下：

| \<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\> \<version\>1.0.1\</version\> \<trancode\>charge\</trancode\> \<transeqnum\>10000001\</transeqnum\> \<merchantid\>1234567\</merchantid\> \</head\> \<info\> \<bill_key\>12345678\</bill_key\> \<company_id\>12345\</company_id\> \<bill_no\>wx31020431\</bill_no\> \<transaction_id\>400\*\*\*\</transaction_id\> \<pay_date\>20151020\</pay_date\> \<customer_name\>李四\</customer_name\> \<pay_amount\>100\</pay_amount\> \<attach\>abcd\</attach\> \<bill_month\>201609\</bill_month\> \</info\> \</wxlifepay\> |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|


注：发起请求数据会进行签名。参见签名规则部分说明。

返回结果：

| 变量名          | 字段名         | 长度     | 约束条件 | 说明                                 |
|-----------------|----------------|----------|----------|--------------------------------------|
| 消息头部        |                |          |          |                                      |
| version         | 版本号         | char(6)  | 必填     | 1.0.1                                |
| ret_code        | 返回码         | char(10) | 必填     | 销帐请求返回码                       |
| err_msg         | 返回码信息     | char(20) | 必填     | 销帐请求返回信息                     |
| trancode        | 交易码         | char(15) | 必填     | charge                               |
| transeqnum      | 交易流水号     | char(20) | 必填     | 交易流水号                           |
| merchantid      | 商户号         | char(32) | 必填     | 商户号                               |
| 消息体          |                |          |          |                                      |
| bill_key        | 机表号         | char(35) | 必填     | 缴费单标识号                         |
| company_id      | 机构代号       | char(30) | 必填     | 收费单位唯一标识号                   |
| bill_no         | 缴费单的流水号 | char(16) | 必填     | 原样返回                             |
| pay_date        | 缴费单支付日期 | char(14) | 必填     | 原样返回                             |
| pay_amount      | 缴费金额       | num(16)  | 必填     | 原样返回                             |
| channel_bill_no | 渠道方缴费单号 | char(16) | 必填     | 标识渠道侧缴费单                     |
| field1          | 预留字段       | char(64) | 选填     | 需要微信生活缴费平台展示、存储的信息 |
| field2          | 预留字段       | char(64) | 选填     | 需要微信生活缴费平台展示、存储的信息 |
| field3          | 预留字段       | char(64) | 选填     | 需要微信生活缴费平台展示、存储的信息 |
| field4          | 预留字段       | char(64) | 选填     | 需要微信生活缴费平台展示、存储的信息 |
| field5          | 预留字段       | char(64) | 选填     | 需要微信生活缴费平台展示、存储的信息 |
| detail          | 预留字段       | char(64) | 选填     | 需要微信生活缴费平台展示、存储的信息 |

注：返回数据需进行签名。

举例如下：

| \<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\> |
|-----------------------------------------------------------------|


>   \<version\>1.0.1\</version\>

>   \<trancode\>charge\</trancode\>

>   \<transeqnum\>10000001\</transeqnum\>

>   \<merchantid\>1234567\</merchantid\>

>   \<ret_code\>0\</ret_code\>

>   \<err_msg\>success\</err_msg\>

>   \</head\>

>   \<info\>

>   \<bill_key\>12345678\</bill_key\>

>   \<company_id\>12345\</company_id\>

>   \<bill_no\>\</bill_no\>

>   \<pay_date\>20151020\</pay_date\>

>   \<pay_amount\>1200\</pay_amount\>

>   \<channel_bill_no\>2015102000001000\</channel_bill_no\>

>   \<field1\>201812\</field1\>

>   \<detail\>success\</detail\>

>   \</info\>

\</wxlifepay\>

注：销帐请求返回数据需进行签名。

3.5、缴费结果回调通知
---------------------

使用场景：

渠道方在收到缴费单位销帐结果后，将销帐结果回调通知到微信侧。回调报文的报文头，需带回发起缴费接口报文头的transeqnum字段。

请求参数：

| 变量名          | 字段名         | 长度       | 约束条件 | 说明                                 |
|-----------------|----------------|------------|----------|--------------------------------------|
| 消息头部        |                |            |          |                                      |
| version         | 版本号         | char(6)    | 必填     | 1.0.1                                |
| trancode        | 交易码         | char(15)   | 必填     | chargecallback                       |
| transeqnum      | 交易流水号     | char(20)   | 必填     | 交易流水号                           |
| merchantid      | 商户号         | char(32)   | 必填     | 商户号                               |
| ret_code        | 返回值         | char(35)   | 必填     | 参见销帐回调错误列表                 |
| err_msg         | 返回信息       | char(1024) | 选填     | 用于页面展示                         |
| 消息体          |                |            |          |                                      |
| bill_key        | 机表号         | char(35)   | 必填     | 缴费单标识号                         |
| company_id      | 机构代号       | char(30)   | 必填     | 收费单位唯一标识号                   |
| bill_no         | 缴费单的流水号 | char(16)   | 必填     | 与发起缴费接口传入一致               |
| pay_date        | 缴费单支付日期 | char(14)   | 必填     | 与发起缴费接口传入一致               |
| pay_amount      | 缴费金额       | num(16)    | 必填     | 与发起缴费接口传入一致               |
| channel_bill_no | 渠道方缴费单号 | char(16)   | 必填     | 标识渠道侧缴费单                     |
| field1          | 预留字段       | char(64)   | 选填     | 需要微信生活缴费平台展示、存储的信息 |
| field2          | 预留字段       | char(64)   | 选填     | 需要微信生活缴费平台展示、存储的信息 |
| field3          | 预留字段       | char(64)   | 选填     | 需要微信生活缴费平台展示、存储的信息 |
| field4          | 预留字段       | char(64)   | 选填     | 需要微信生活缴费平台展示、存储的信息 |
| field5          | 预留字段       | char(64)   | 选填     | 需要微信生活缴费平台展示、存储的信息 |
| detail          | 预留字段       | char(64)   | 选填     | 需要微信生活缴费平台展示、存储的信息 |

注：回调地址由微信提供，渠道商进行配置。

回调举例：

| \<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\> |
|-----------------------------------------------------------------|


>   \<version\>1.0.1\</version\>

>   \<trancode\>chargecallback\</trancode\>

>   \<transeqnum\>10000001\</transeqnum\>

>   \<merchantid\>1234567\</merchantid\>

>   \<ret_code\>0\</ret_code\>

>   \<err_msg\>success\</err_msg\>

>   \</head\>

>   \<info\>

>   \<bill_key\>12345678\</bill_key\>

>   \<company_id\>12345\</company_id\>

>   \<bill_no\> wx31020431\</bill_no\>

>   \<pay_date\>20151020\</pay_date\>

>   \<pay_amount\>1200\</pay_amount\>

>   \<channel_bill_no\>2015102000001\</channel_bill_no\>

>   \</info\>

\</wxlifepay\>

返回结果：

| 变量名                 | 字段名     | 长度     | 约束条件 | 说明           |
|------------------------|------------|----------|----------|----------------|
| 消息头部               |            |          |          |                |
| version                | 版本号     | char(6)  | 必填     | 1.0.1          |
| trancode               | 交易码     | char(15) | 必填     | chargecallback |
| transeqnum             | 交易流水号 | char(20) | 必填     | 交易流水号     |
| merchantid             | 商户号     | char(32) | 必填     | 商户号         |
| ret_code               | 返回值     | char(35) | 必填     | 回调返回码     |
| err_msg                | 返回信息   | char(20) | 选填     | 返回信息       |
| 销帐回调返回消息体为空 |            |          |          |                |

回调返回举例如下：

| \<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\> |
|-----------------------------------------------------------------|


>   \<version\>1.0.1\</version\>

>   \<trancode\>chargecallback\</trancode\>

>   \<transeqnum\>10000001\</transeqnum\>

>   \<merchantid\>1234567\</merchantid\>

>   \<ret_code\>0\</ret_code\>

>   \<err_msg\>success\</err_msg\>

>   \</head\>

>   \<info\>

>   \</info\>

\</wxlifepay\>

3.6、缴费结果查询接口
---------------------

应用场景：由于网络等因素可能存在销帐回调丢数据情况的发生，渠道方提供缴费结果查询接口可有效避免回调通知丢包的情况。此接口由渠道方提供，微信侧用来对销帐回调丢包的情况对销帐结果进行确认。

**请求参数：**

| 变量名         | 字段名         | 长度     | 约束条件 | 说明                         |
|----------------|----------------|----------|----------|------------------------------|
| 头部信息       |                |          |          |                              |
| version        | 版本号         | char(6)  | 必填     | 1.0.1                        |
| trancode       | 交易码         | char(15) | 必填     | confirm                      |
| transeqnum     | 交易流水号     | char(20) | 必填     | 交易流水号                   |
| merchantid     | 商户号         | char(32) | 必填     | 商户号                       |
| 消息体         |                |          |          |                              |
| bill_key       | 用户号         | char(35) | 必填     | 缴费单标识号                 |
| transaction_id | 微信支付订单号 | char(32) | 必填     | 微信支付订单号               |
| company_id     | 机构代号       | char(30) | 必填     | 收费单位唯一标识号           |
| bill_no        | 缴费单的流水号 | char(16) | 必填     | 微信生活缴费平台的业务流水号 |
| pay_amount     | 缴费金额       | num(16)  | 必填     | (单位：分)                   |

查询报文举例：

| \<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\> |
|-----------------------------------------------------------------|


>   \<version\>1.0.1\</version\>

>   \<trancode\>confirm\</trancode\>

>   \<transeqnum\>10000001\</transeqnum\>

>   \<merchantid\>1234567\</merchantid\>

>   \</head\>

>   \<info\>

>   \<bill_key\>12345678\</bill_key\>

>   \<company_id\>12345\</company_id\>

>   \<bill_no\>wx31020431\</bill_no\>

>   \<transaction_id\>400\*\*\*\</transaction_id\>

>   \<pay_amount\>100\</pay_amount\>

>   \</info\>

\</wxlifepay\>

**返回参数说明：**

| 变量名          | 字段名         | 长度       | 约束条件 | 说明                                 |
|-----------------|----------------|------------|----------|--------------------------------------|
| 头部信息        |                |            |          |                                      |
| version         | 版本号         | char(6)    | 必填     | 1.0.1                                |
| trancode        | 交易码         | char(15)   | 必填     | confirm                              |
| transeqnum      | 交易流水号     | char(20)   | 必填     | 交易流水号                           |
| merchantid      | 商户号         | char(32)   | 必填     | 商户号                               |
| ret_code        | 返回值         | char(35)   | 必填     | 正确填0                              |
| err_msg         | 返回信息       | char(1024) | 选填     | 用于页面展示                         |
| 消息体          |                |            |          |                                      |
| bill_key        | 机表号         | char(35)   | 必填     | 缴费单标识号                         |
| company_id      | 机构代号       | char(30)   | 必填     | 收费单位唯一标识号                   |
| bill_no         | 缴费单的流水号 | char(16)   | 必填     | 与发起缴费接口传入一致               |
| pay_date        | 缴费单支付日期 | char(14)   | 必填     | 与发起缴费接口传入一致               |
| pay_amount      | 缴费金额       | num(16)    | 必填     | 与发起缴费接口传入一致               |
| channel_bill_no | 渠道方缴费单号 | char(16)   | 必填     | 标识渠道侧缴费单                     |
| field1          | 预留字段       | char(64)   | 选填     | 需要微信生活缴费平台展示、存储的信息 |
| field2          | 预留字段       | char(64)   | 选填     | 需要微信生活缴费平台展示、存储的信息 |
| field3          | 预留字段       | char(64)   | 选填     | 需要微信生活缴费平台展示、存储的信息 |
| field4          | 预留字段       | char(64)   | 选填     | 需要微信生活缴费平台展示、存储的信息 |
| field5          | 预留字段       | char(64)   | 选填     | 需要微信生活缴费平台展示、存储的信息 |
| detail          | 预留字段       | char(64)   | 选填     | 需要微信生活缴费平台展示、存储的信息 |

返回报文：

| xxxxxx \<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\> |
|------------------------------------------------------------------------|


>   \<version\>1.0.1\</version\>

>   \<trancode\>confirm\</trancode\>

>   \<transeqnum\>10000001\</transeqnum\>

>   \<merchantid\>1234567\</merchantid\>

>   \<ret_code\>0\</ret_code\>

>   \<err_msg\>success\</err_msg\>

>   \</head\>

>   \<info\>

>   \<bill_key\>12345678\</bill_key\>

>   \<company_id\>12345\</company_id\>

>   \<bill_no\> wx31020431\</bill_no\>

>   \<pay_date\>20151020\</pay_date\>

>   \<pay_amount\>1200\</pay_amount\>

>   \<channel_bill_no\>2015102000001\</channel_bill_no\>

>   \</info\>

\</wxlifepay\>

3.7、公共事业单位维护通知
-------------------------

>   公共事业维护时，渠道机构可把维护文件通过sftp同步到微信服务器，微信给出页面提示。

>   文件格式：

>   每行末尾换行符：’\\n’

>   每行内容：停运通知号\|+\|缴费编号\|+\|缴费项目名称\|+\|停运原因\|+\|停运说明\|+\|停运起始时间\|+\|停运终止时间\|+\|维护日期\|+\|维护时间\|+\|备注

>   文件末尾：END

1.  文件名称：XX（渠道标识）_OUTAGENOTICE_YYYYMMDD_序号.TXT（序号从01开始）

2.  时间格式：（时间格式：YYYYMMDD24HHMISS）

3.8、申请退款（银行渠道断直连专用）
-----------------------------------

使用场景：

当交易发生之后一段时间内，银行渠道方可以通过退款接口将支付款退还给买家。 注意:

1、交易时间超过一年的订单无法提交退款;

2、请求频率限制:150qps，即每秒钟正常的申请退款请求次数不超过 150
次。错误或无效请求频率限制: 6qps，即每秒钟异常或错误的退款申请请求不超过 6 次。

请求参数：

| 变量名      | 字段名         | 长度     | 约束条件 | 说明                                               |
|-------------|----------------|----------|----------|----------------------------------------------------|
| 消息头部    |                |          |          |                                                    |
| version     | 版本号         | char(6)  | 必填     | 1.0                                                |
| trancode    | 交易码         | char(15) | 必填     | bankrefund                                         |
| merchantid  | 商户号         | char(32) | 必填     | 商户号                                             |
| 消息体      |                |          |          |                                                    |
| bill_no     | 缴费单的流水号 | char(16) | 必填     | 微信生活缴费平台的业务流水号                       |
| refund_desc | 退款原因       | char(80) | 选填     | 若商户传入，会在下发给用户的退款消息中体现退款原因 |

退款举例：

| \<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\> |
|-----------------------------------------------------------------|


>   \<version\>1.0\</version\>

>   \<trancode\>bankrefund\</trancode\>

>   \<merchantid\>1900009211\</merchantid\>

>   \</head\>

>   \<info\>

>   \<bill_no\>12177525012018\</bill_no\>

>   \</info\>

\</wxlifepay\>

返回结果：

| 变量名         | 字段名     | 长度     | 约束条件 | 说明                |
|----------------|------------|----------|----------|---------------------|
| 消息头部       |            |          |          |                     |
| version        | 版本号     | char(6)  | 必填     | 1.0                 |
| trancode       | 交易码     | char(15) | 必填     | bankrefund          |
| merchantid     | 商户号     | char(32) | 必填     | 商户号              |
| transeqnum     | 交易流水号 | char(20) | 必填     | 交易流水号          |
| ret_code       | 返回值     | char(35) | 必填     | 回调返回码，0为成功 |
| err_msg        | 返回信息   | char(20) | 选填     | 返回信息            |
| 返回消息体为空 |            |          |          |                     |

退款返回举例如下：

| \<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\> |
|-----------------------------------------------------------------|


>   \<version\>1.0\</version\>

>   \<trancode\>bankrefund\</trancode\>

>   \<merchantid\>1900009211\</merchantid\>

>   \<transeqnum\>21231456\</transeqnum\>

>   \<ret_code\>0\</ret_code\>

>   \<err_msg\>success\</err_msg\>

>   \</head\>

>   \<info\>

>   \</info\>

\</wxlifepay\>

3.9、状态通知
-------------

使用场景：

渠道更新订单状态时，通过此接口将结果同步给生活缴费平台。

请求参数：

| 变量名     | 字段名     | 长度     | 约束条件 | 说明                         |
|------------|------------|----------|----------|------------------------------|
| 头部信息   |            |          |          |                              |
| version    | 版本号     | char(6)  | 必填     | 1.0.1                        |
| trancode   | 交易码     | char(15) | 必填     | statusnotify                 |
| transeqnum | 交易流水号 | char(20) | 必填     | 交易流水号                   |
| merchantid | 商户号     | char(32) | 必填     | 商户号                       |
| 消息体     |            |          |          |                              |
| bill_key   | 机表号     | char(35) | 选填     | 缴费单标识号                 |
| company_id | 机构代号   | char(30) | 必填     | 收费单位唯一标识号           |
| bill_no    | 缴费单号   | char(16) | 必填     | 微信生活缴费平台的业务流水号 |
| status     | 订单状态   | char(16) | 必填     | SUCCESS:成功 FAIL:失败       |
| pay_amount | 缴费金额   | num (16) | 选填     | 订单缴费金额                 |

状态通知举例：

| \<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\> \<version\>1.0.1\</version\> \<trancode\>statusnotify\</trancode\> \<transeqnum\>305912304\</transeqnum\> \<merchantid\>1000098501\</merchantid\> \</head\> \<info\> \<bill_key\>007226\</bill_key\> \<company_id\>595100101\</company_id\> \<bill_no\>0FWRd0dHh6AIg369\</bill_no\> \<status\>SUCCESS\</status\> \<pay_amount\>1\</pay_amount\> \</info\> \</wxlifepay\> |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|


返回结果：

| 变量名                 | 字段名     | 长度     | 约束条件 | 说明         |
|------------------------|------------|----------|----------|--------------|
| 消息头部               |            |          |          |              |
| version                | 版本号     | char(6)  | 必填     | 1.0.1        |
| trancode               | 交易码     | char(15) | 必填     | statusnotify |
| transeqnum             | 交易流水号 | char(20) | 必填     | 交易流水号   |
| merchantid             | 商户号     | char(32) | 必填     | 商户号       |
| ret_code               | 返回值     | char(35) | 必填     | 回调返回码   |
| 销帐回调返回消息体为空 |            |          |          |              |

状态通知举例：

| \<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\> \<version\>1.0.1\</version\> \<trancode\>statusnotify\</trancode\> \<transeqnum\>305912304\</transeqnum\> \<merchantid\>1000098501\</merchantid\> |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|


>   \<ret_code\>0\</ret_code\>

\</head\>

\<info\>

\</info\>

\</wxlifepay\>

委托代扣
========

4.1、委托代扣交互逻辑
---------------------

![](media/2abb6d5ff3b92c66946df01efd260abb.emf)

4.2、委托代扣接口列表
---------------------

| 序号 | 交易名称               | 交易用途                                                                           | 交易频率     | 接口类型标识      | 交易发起方 |
|------|------------------------|------------------------------------------------------------------------------------|--------------|-------------------|------------|
| 1    | 查询用户信息接口       | 微信通过此接口向第三方渠道商发起用户信息查询请求                                   | 实时发起     | userquery         | 微信       |
| 2    | 签约接口               | 微信通过此接口向第三方渠道商发起签约请求                                           | 实时发起     | papaysign         | 微信       |
| 3    | 代扣配置接口           | 对于预付费用户，用户在签约后，微信将通过此接口向第三方渠道商发起代扣协议的配置请求 | 实时发起     | papayset          | 微信       |
| 4    | 解约接口（微信侧主调） | 微信向第三方渠道商发起解约请求                                                     | 实时发起     | papaydeletesign   | 微信       |
| 5    | 解约接口（渠道商主调） | 第三方渠道商向微信发起解约请求                                                     | 实时发起     | papaychdeletesign | 渠道商     |
| 6    | 账单通知文件           | 第三方渠道商向微信推送需要扣款的账单信息                                           | 每日固定时间 | 无                | 渠道商     |
| 7    | 订单支付文件           | 微信向第三方渠道商推送扣款结果信息                                                 | 每日固定时间 | 无                | 微信       |

4.3、查询用户信息接口
---------------------

应用场景：

此接口用于查询用户的账户信息。微信侧向渠道方发起代扣协议配置请求，渠道方收到协议配置请求后给予应答，返回配置结果。

请求参数：

| 变量名     | 字段名     | 长度     | 约束条件 | 说明               |
|------------|------------|----------|----------|--------------------|
| 头部信息   |            |          |          |                    |
| version    | 版本号     | char(6)  | 必填     | 1.0.1              |
| trancode   | 交易码     | char(15) | 必填     | queryuser          |
| transeqnum | 交易流水号 | char(20) | 必填     | 交易流水号         |
| merchantid | 商户号     | char(32) | 必填     | 商户号             |
| 消息体     |            |          |          |                    |
| bill_key   | 机表号     | char(35) | 必填     | 缴费单标识号       |
| company_id | 机构代号   | char(30) | 必填     | 收费单位唯一标识号 |
| service_id | 业务类型ID | num(8)   | 必填     | 参见“业务类型列表” |

举例如下：

| \<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\> \<version\>1.0.1\</version\> \<trancode\> queryuser \</trancode\> \<transeqnum\>10000001\</transeqnum\> \<merchantid\>1234567\</merchantid\> \</head\> \<info\> \<bill_key\>12345678\</bill_key\> \<company_id\>12345\</company_id\> \<service_id\>2\</ service \_id\> \</info\> \</wxlifepay\> |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|


注：发起请求数据会进行签名。参见签名规则部分说明。

返回结果：

| 变量名                       | 字段名             | 长度      | 约束条件 | 说明                                           |
|------------------------------|--------------------|-----------|----------|------------------------------------------------|
| 消息头部                     |                    |           |          |                                                |
| version                      | 版本号             | char(6)   | 必填     | 1.0.1                                          |
| ret_code                     | 返回码             | char(10)  | 必填     | 请求返回码                                     |
| err_msg                      | 返回码信息         | char(20)  | 必填     | 请求返回信息                                   |
| trancode                     | 交易码             | char(15)  | 必填     | queryuser                                      |
| transeqnum                   | 交易流水号         | char(20)  | 必填     | 交易流水号                                     |
| merchantid                   | 商户号             | char(32)  | 必填     | 商户号                                         |
| 消息体                       |                    |           |          |                                                |
| bill_key                     | 机表号             | char(35)  | 必填     | 原样返回                                       |
| company_id                   | 机构代号           | char(30)  | 必填     | 原样返回                                       |
| service_id                   | 业务类型ID         | num(8)    | 必填     | 原样返回                                       |
| customer_name                | 客户姓名           | char(100) | 必填     |                                                |
| customer_addr                | 客户地址           | char(256) | 选填     |                                                |
| account_type                 | 账户类型           | char(32)  | 必填     | prepaid：预付费 postpaid：后付费               |
| current_sign                 | 用户当前签约渠道   | char(32)  | 选填     | 用户当前签约渠道标识                           |
| merchantid                   | 商户号             | char(32)  | 必填     | 商户号                                         |
| recharge_limit_amount        | 充值限额           | num(16)   | 必填     | 当用户账户金额低于此金额时需要充值。(单位：分) |
| recharge_limit_amount_modify | 充值限额是否可修改 | char(8)   | 必填     | yes：可修改 no：不可修改                       |
| recharge_amount              | 充值金额           | num(16)   | 必填     | 用户账户每次需要充值时所充值的金额。(单位：分) |
| recharge_amount_modify       | 充值金额是否可修改 | char(8)   | 必填     | yes：可修改 no：不可修改                       |

注：返回数据需进行签名。

举例如下：

| \<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\> \<version\>1.0.1\</version\> \<trancode\> queryuser \</trancode\> \<transeqnum\>10000001\</transeqnum\> \<merchantid\>1234567\</merchantid\> \<ret_code\>0\</ret_code\> \<err_msg\>success\</err_msg\> \</head\> \<info\> \<bill_key\>12345678\</bill_key\> \<company_id\>12345\</company_id\> \<service_id\>2\</ service \_id\> \< customer_name \> 张三\</ customer_name \> \< customer_addr \> \*\*小区\*\*室\</ customer_addr \> \< account_type \>postpaid\</ account_type \> \< merchantid \>12345\</ merchantid \> \< recharge_limit_amount \>100\</ recharge_limit_amount \> \< recharge_limit_amount_modify \>no\</ recharge_limit_amount_modify \> \< recharge_amount \>5000\</ recharge_amount \> \< recharge_amount_modify \>yes\</ recharge_amount_modify \> \</info\> \</wxlifepay\> |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|


注：返回数据需进行签名。

4.4、签约接口
-------------

应用场景：

此接口用于请求签约委托代扣协议。用户确认开通委托代扣之后，微信侧向渠道方发起签约请求，渠道方收到签约请求后给予应答，返回签约结果。

请求参数：

| 变量名                | 字段名         | 长度      | 约束条件 | 说明                                           |
|-----------------------|----------------|-----------|----------|------------------------------------------------|
| 头部信息              |                |           |          |                                                |
| version               | 版本号         | char(6)   | 必填     | 1.0.1                                          |
| trancode              | 交易码         | char(15)  | 必填     | papaysign                                      |
| transeqnum            | 交易流水号     | char(20)  | 必填     | 交易流水号                                     |
| merchantid            | 商户号         | char(32)  | 必填     | 商户号                                         |
| 消息体                |                |           |          |                                                |
| open_id               | 用户身份标识   | char(128) | 必填     | 用户在微信生活缴费平台的唯一标识               |
| bill_key              | 机表号         | char(35)  | 必填     | 缴费单标识号                                   |
| company_id            | 机构代号       | char(30)  | 必填     | 收费单位唯一标识号                             |
| service_id            | 业务类型ID     | num(8)    | 必填     | 参见“业务类型列表”                             |
| account_contract_id   | 委托代扣协议id | char(64)  | 必填     | 用户此次签约的协议id                           |
| account_type          | 账户类型       | char(32)  | 必填     | prepaid：预付费 postpaid：后付费               |
| recharge_limit_amount | 充值限额       | num(16)   | 必填     | 当用户账户金额低于此金额时需要充值。(单位：分) |
| recharge_amount       | 充值金额       | num(16)   | 必填     | 用户账户每次需要充值时所充值的金额。(单位：分) |

举例如下：

| \<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\> \<version\>1.0.1\</version\> \<trancode\> papaysign \</trancode\> \<transeqnum\>10000001\</transeqnum\> \<merchantid\>1234567\</merchantid\> \</head\> \<info\> \< open_id \> onqOjjmM1tad-3ROpnc\</ open_id \> \<bill_key\>12345678\</bill_key\> \<company_id\>12345\</company_id\> \<service_id\>2\</ service \_id\> \< account_contract_id \> wx31020431400\*\*\*\</ account_contract_id \> \< account_type \>postpaid\</ account_type \> \< recharge_limit_amount \>100\</ recharge_limit_amount \> \< recharge_amount \>200\</ recharge_amount \> \</info\> \</wxlifepay\> |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|


注：发起请求数据会进行签名。参见签名规则部分说明。

返回结果：

| 变量名              | 字段名         | 长度      | 约束条件 | 说明         |
|---------------------|----------------|-----------|----------|--------------|
| 消息头部            |                |           |          |              |
| version             | 版本号         | char(6)   | 必填     | 1.0.1        |
| ret_code            | 返回码         | char(10)  | 必填     | 请求返回码   |
| err_msg             | 返回码信息     | char(20)  | 必填     | 请求返回信息 |
| trancode            | 交易码         | char(15)  | 必填     | papaysign    |
| transeqnum          | 交易流水号     | char(20)  | 必填     | 交易流水号   |
| merchantid          | 商户号         | char(32)  | 必填     | 商户号       |
| 消息体              |                |           |          |              |
| open_id             | 用户身份标识   | char(128) | 必填     | 原样返回     |
| bill_key            | 机表号         | char(35)  | 必填     | 原样返回     |
| company_id          | 机构代号       | char(30)  | 必填     | 原样返回     |
| service_id          | 业务类型ID     | num(8)    | 必填     | 原样返回     |
| account_contract_id | 委托代扣协议id | char(64)  | 必填     | 原样返回     |
| account_type        | 账户类型       | char(32)  | 必填     | 原样返回     |
|                     |                |           |          |              |

注：返回数据需进行签名。

举例如下：

| \<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\> \<version\>1.0.1\</version\> \<trancode\> papaysign \</trancode\> \<transeqnum\>10000001\</transeqnum\> \<merchantid\>1234567\</merchantid\> \<ret_code\>0\</ret_code\> \<err_msg\>success\</err_msg\> \</head\> \<info\> \< open_id \> onqOjjmM1tad-3ROpnc\</ open_id \> \<bill_key\>12345678\</bill_key\> \<company_id\>12345\</company_id\> \<service_id\>2\</ service \_id\> \< account_contract_id \> wx31020431400\*\*\*\</ account_contract_id \> \< account_type \>postpaid\</ account_type \> \</info\> \</wxlifepay\> |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|


注：返回数据需进行签名。

4.5、代扣配置接口
-----------------

应用场景：

此接口用于预付费用户来设置委托代扣协议配置，对于后付费用户将不会调用该接口。对于预付费用户在进行委托代扣的签约之后，会设置具体的代扣方案，微信侧向渠道方发起代扣协议配置请求，渠道方收到协议配置请求后给予应答，返回配置结果。

请求参数：

| 变量名                | 字段名         | 长度      | 约束条件 | 说明                                           |
|-----------------------|----------------|-----------|----------|------------------------------------------------|
| 头部信息              |                |           |          |                                                |
| version               | 版本号         | char(6)   | 必填     | 1.0.1                                          |
| trancode              | 交易码         | char(15)  | 必填     | papayset                                       |
| transeqnum            | 交易流水号     | char(20)  | 必填     | 交易流水号                                     |
| merchantid            | 商户号         | char(32)  | 必填     | 商户号                                         |
| 消息体                |                |           |          |                                                |
| open_id               | 用户身份标识   | char(128) | 必填     | 用户在微信生活缴费平台的唯一标识               |
| bill_key              | 机表号         | char(35)  | 必填     | 缴费单标识号                                   |
| company_id            | 机构代号       | char(30)  | 必填     | 收费单位唯一标识号                             |
| service_id            | 业务类型ID     | num(8)    | 必填     | 参见“业务类型列表”                             |
| account_contract_id   | 委托代扣协议id | char(64)  | 必填     | 用户此次签约的协议id                           |
| account_type          | 账户类型       | char(32)  | 必填     | prepaid：预付费 postpaid：后付费               |
| recharge_limit_amount | 充值限额       | num(16)   | 必填     | 当用户账户金额低于此金额时需要充值。(单位：分) |
| recharge_amount       | 充值金额       | num(16)   | 必填     | 用户账户每次需要充值时所充值的金额。(单位：分) |

举例如下：

| \<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\> \<version\>1.0.1\</version\> \<trancode\> papayset \</trancode\> \<transeqnum\>10000001\</transeqnum\> \<merchantid\>1234567\</merchantid\> \</head\> \<info\> \< open_id \> onqOjjmM1tad-3ROpnc\</ open_id \> \<bill_key\>12345678\</bill_key\> \<company_id\>12345\</company_id\> \<service_id\>2\</ service \_id\> \< account_contract_id \> wx31020431400\*\*\*\</ account_contract_id \> \< account_type \>postpaid\</ account_type \> \< recharge_limit_amount \>100\</ recharge_limit_amount \> \< recharge_amount \>200\</ recharge_amount \> \</info\> \</wxlifepay\> |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|


注：发起请求数据会进行签名。参见签名规则部分说明。

返回结果：

| 变量名              | 字段名         | 长度      | 约束条件 | 说明         |
|---------------------|----------------|-----------|----------|--------------|
| 消息头部            |                |           |          |              |
| version             | 版本号         | char(6)   | 必填     | 1.0.1        |
| ret_code            | 返回码         | char(10)  | 必填     | 请求返回码   |
| err_msg             | 返回码信息     | char(20)  | 必填     | 请求返回信息 |
| trancode            | 交易码         | char(15)  | 必填     | papayset     |
| transeqnum          | 交易流水号     | char(20)  | 必填     | 交易流水号   |
| merchantid          | 商户号         | char(32)  | 必填     | 商户号       |
| 消息体              |                |           |          |              |
| open_id             | 用户身份标识   | char(128) | 必填     | 原样返回     |
| bill_key            | 机表号         | char(35)  | 必填     | 原样返回     |
| company_id          | 机构代号       | char(30)  | 必填     | 原样返回     |
| service_id          | 业务类型ID     | num(8)    | 必填     | 原样返回     |
| account_contract_id | 委托代扣协议id | char(64)  | 必填     | 原样返回     |

注：返回数据需进行签名。

举例如下：

| \<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\> \<version\>1.0.1\</version\> \<trancode\> papayset \</trancode\> \<transeqnum\>10000001\</transeqnum\> \<merchantid\>1234567\</merchantid\> \</head\> \<info\> \< open_id \> onqOjjmM1tad-3ROpnc\</ open_id \> \<bill_key\>12345678\</bill_key\> \<company_id\>12345\</company_id\> \<service_id\>2\</ service \_id\> \< account_contract_id \> wx31020431400\*\*\*\</ account_contract_id \> \</info\> \</wxlifepay\> |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|


注：返回数据需进行签名。

4.6、解约接口（微信侧主调）
---------------------------

应用场景：

此接口用于请求解约委托代扣协议。用户确认关闭委托代扣之后，微信侧向渠道方发起解约请求，渠道商收到解约请求后给予应答，返回解约结果。

请求参数：

| 变量名              | 字段名         | 长度      | 约束条件 | 说明                                                             |
|---------------------|----------------|-----------|----------|------------------------------------------------------------------|
| 头部信息            |                |           |          |                                                                  |
| version             | 版本号         | char(6)   | 必填     | 1.0.1                                                            |
| trancode            | 交易码         | char(15)  | 必填     | papaydeletesign                                                  |
| transeqnum          | 交易流水号     | char(20)  | 必填     | 交易流水号                                                       |
| merchantid          | 商户号         | char(32)  | 必填     | 商户号                                                           |
| 消息体              |                |           |          |                                                                  |
| open_id             | 用户身份标识   | char(64)  | 必填     | 用户在微信生活缴费平台的唯一标识                                 |
| bill_key            | 机表号         | char(35)  | 必填     | 缴费单标识号                                                     |
| company_id          | 机构代号       | char(30)  | 必填     | 收费单位唯一标识号                                               |
| service_id          | 业务类型ID     | num(8)    | 必填     | 参见“业务类型列表”                                               |
| account_contract_id | 委托代扣协议id | char(32)  | 必填     | 用户此次签约的协议id                                             |
| reason_code         | 解约原因代码   | char(16)  | 必填     | change：更换为其他代扣平台 outdate：代扣协议到期 other：其他原因 |
| reason_name         | 解约原因详情   | char(100) | 必填     | 解约原因详情                                                     |

举例如下：

| \<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\> \<version\>1.0.1\</version\> \<trancode\> papaydeletesign \</trancode\> \<transeqnum\>10000001\</transeqnum\> \<merchantid\>1234567\</merchantid\> \</head\> \<info\> \< open_id \> onqOjjmM1tad-3ROpnc\</ open_id \> \<bill_key\>12345678\</bill_key\> \<company_id\>12345\</company_id\> \<service_id\>2\</ service \_id\> \< account_contract_id \> wx31020431400\*\*\*\</ account_contract_id \> \< reason_code \>change\</ reason_code \> \< reason_name \>用户已在其他平台签约\</ reason_name \> \</info\> \</wxlifepay\> |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|


注：发起请求数据会进行签名。参见签名规则部分说明。

返回结果：

| 变量名              | 字段名         | 长度      | 约束条件 | 说明            |
|---------------------|----------------|-----------|----------|-----------------|
| 消息头部            |                |           |          |                 |
| version             | 版本号         | char(6)   | 必填     | 1.0.1           |
| ret_code            | 返回码         | char(10)  | 必填     | 请求返回码      |
| err_msg             | 返回码信息     | char(20)  | 必填     | 请求返回信息    |
| trancode            | 交易码         | char(15)  | 必填     | papaydeletesign |
| transeqnum          | 交易流水号     | char(20)  | 必填     | 交易流水号      |
| merchantid          | 商户号         | char(32)  | 必填     | 商户号          |
| 消息体              |                |           |          |                 |
| open_id             | 用户身份标识   | char(128) | 必填     | 原样返回        |
| bill_key            | 机表号         | char(35)  | 必填     | 原样返回        |
| company_id          | 机构代号       | char(30)  | 必填     | 原样返回        |
| service_id          | 业务类型ID     | num(8)    | 必填     | 原样返回        |
| account_contract_id | 委托代扣协议id | char(64)  | 必填     | 原样返回        |

注：返回数据需进行签名。

举例如下：

| \<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\> \<version\>1.0.1\</version\> \<trancode\> papaydeletesign \</trancode\> \<transeqnum\>10000001\</transeqnum\> \<merchantid\>1234567\</merchantid\> \<ret_code\>0\</ret_code\> \<err_msg\>success\</err_msg\> \</head\> \<info\> \< open_id \> onqOjjmM1tad-3ROpnc\</ open_id \> \<bill_key\>12345678\</bill_key\> \<company_id\>12345\</company_id\> \<service_id\>2\</ service \_id\> \< account_contract_id \> wx31020431400\*\*\*\</ account_contract_id \> \</info\> \</wxlifepay\> |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|


注：返回数据需进行签名。

4.7、解约接口（渠道商主调）
---------------------------

应用场景：

此接口用于请求解约委托代扣协议。用户确认关闭委托代扣之后，渠道方向微信侧发起解约请求，微信侧收到解约请求后给予应答，返回解约结果。

请求参数：

| 变量名              | 字段名         | 长度      | 约束条件                                                                | 说明                                                             |
|---------------------|----------------|-----------|-------------------------------------------------------------------------|------------------------------------------------------------------|
| 头部信息            |                |           |                                                                         |                                                                  |
| version             | 版本号         | char(6)   | 必填                                                                    | 1.0.1                                                            |
| trancode            | 交易码         | char(15)  | 必填                                                                    | papaychdeletesign                                                |
| transeqnum          | 交易流水号     | char(20)  | 必填                                                                    | 交易流水号                                                       |
| merchantid          | 商户号         | char(32)  | 必填                                                                    | 商户号                                                           |
| 消息体              |                |           |                                                                         |                                                                  |
| open_id             | 用户身份标识   | char(64)  | 必填                                                                    | 用户在微信生活缴费平台的唯一标识                                 |
| bill_key            | 机表号         | char(35)  | （机表号、机构代号、业务类型ID）、 （委托代扣协议id） 二选一 建议都赋值 | 缴费单标识号                                                     |
| company_id          | 机构代号       | char(30)  |                                                                         | 收费单位唯一标识号                                               |
| service_id          | 业务类型ID     | num(8)    |                                                                         | 参见“业务类型列表”                                               |
| account_contract_id | 委托代扣协议id | char(32)  |                                                                         | 用户此次签约的协议id                                             |
| reason_code         | 解约原因代码   | char(16)  | 必填                                                                    | change：更换为其他代扣平台 outdate：代扣协议到期 other：其他原因 |
| reason_name         | 解约原因详情   | char(100) | 必填                                                                    | 解约原因详情                                                     |

举例如下：

| \<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\> \<version\>1.0.1\</version\> \<trancode\> papaychdeletesign \</trancode\> \<transeqnum\>10000001\</transeqnum\> \<merchantid\>1234567\</merchantid\> \</head\> \<info\> \< open_id \> onqOjjmM1tad-3ROpnc\</ open_id \> \<bill_key\>12345678\</bill_key\> \<company_id\>12345\</company_id\> \<service_id\>2\</ service \_id\> \< account_contract_id \> wx31020431400\*\*\*\</ account_contract_id \> \< reason_code \>change\</ reason_code \> \< reason_name \>用户已在其他平台签约\</ reason_name \> \</info\> \</wxlifepay\> |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|


注：发起请求数据会进行签名。参见签名规则部分说明。

返回结果：

| 变量名              | 字段名         | 长度      | 约束条件 | 说明              |
|---------------------|----------------|-----------|----------|-------------------|
| 消息头部            |                |           |          |                   |
| version             | 版本号         | char(6)   | 必填     | 1.0.1             |
| ret_code            | 返回码         | char(10)  | 必填     | 请求返回码        |
| err_msg             | 返回码信息     | char(20)  | 必填     | 请求返回信息      |
| trancode            | 交易码         | char(15)  | 必填     | papaychdeletesign |
| transeqnum          | 交易流水号     | char(20)  | 必填     | 交易流水号        |
| merchantid          | 商户号         | char(32)  | 必填     | 商户号            |
| 消息体              |                |           |          |                   |
| open_id             | 用户身份标识   | char(128) | 必填     | 原样返回          |
| bill_key            | 机表号         | char(35)  | 必填     | 原样返回          |
| company_id          | 机构代号       | char(30)  | 必填     | 原样返回          |
| service_id          | 业务类型ID     | num(8)    | 必填     | 原样返回          |
| account_contract_id | 委托代扣协议id | char(64)  | 必填     | 原样返回          |

注：返回数据需进行签名。

举例如下：

| \<?xml version="1.0" encoding="UTF-8"?\> \<wxlifepay\> \<head\> \<version\>1.0.1\</version\> \<trancode\> papaychdeletesign \</trancode\> \<transeqnum\>10000001\</transeqnum\> \<merchantid\>1234567\</merchantid\> \<ret_code\>0\</ret_code\> \<err_msg\>success\</err_msg\> \</head\> \<info\> \< open_id \> onqOjjmM1tad-3ROpnc\</ open_id \> \<bill_key\>12345678\</bill_key\> \<company_id\>12345\</company_id\> \<service_id\>2\</ service \_id\> \< account_contract_id \> wx31020431400\*\*\*\</ account_contract_id \> \</info\> \</wxlifepay\> |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|


注：返回数据需进行签名。

4.8、账单通知文件
-----------------

>   渠道方生成签约用户的账单之后，可把账单文件通过sftp同步到微信服务器，微信根据账单文件进行扣款。

>   文件格式：

>   首行格式：总记录数\|+\|总账单金额

>   每行内容：用户身份标识\|+\|委托代扣协议id
>   \|+\|机构代号\|+\|机表号\|+\|业务类型ID\|+\|用户姓名\|+\|账期\|+\|帐户余额\|+\|账单金额\|+\|渠道代扣单号\|+\|城市编号\|+\|备注

>   文件末尾：END

>   每行末尾换行符：\\n

文件名称：XX（父商户号）_PAPAYBILL_YYYYMMDD.TXT

注：

>   对于后付费用户：若无账户余额，则该字段可为0；账单金额必填；

>   对于预付费用户：账户余额必填，账单金额为用户设置的充值金额；

4.9、订单支付文件
-----------------

>   微信侧对用户帐单进行扣款之后，把扣款结果通过sftp同步到渠道方。

>   文件格式：

>   首行格式：总记录数\|+\|总代扣金额

>   每行内容：用户身份标识\|+\|委托代扣协议id\|+\|机构代号\|+\|机表号\|+\|业务类型ID\|+\|扣款结果标识\|+\|代扣金额\|+\|代扣失败说明\|+\|微信支付订单号\|+\|渠道代扣单号\|+\|备注

>   文件末尾：END

>   每行末尾换行符：\\n

文件名称：XX（渠道标识）_PAPAYORDER_SUCCESS_YYYYMMDD.TXT

注：

1. 扣款结果标识：“S”：成功、“E”：失败；对于失败扣款，代扣金额为空；

2. 对于代扣失败的订单，建议渠道方在确认欠费后，次日继续推送给微信侧尝试扣款；

3. 目前只返回代扣成功的订单；

错误码列表
==========

微信侧定义统一的错误码，渠道商需针对相应的错误返回指定的错误码填充在报文头的ret_code字段，而渠道商系统的错误，应与具体错误提示一并通过err_msg字段返回（方便渠道商问题定位）。而给用户的错误提示一并按下面错误列表中“页面提示”给用户展示。

错误码的规则：E+错误码类型（Q查询，P缴费，
S缴费状态，R代扣查询，G签约，U解约，T代扣配置，BR 银行渠道断直连退款）。

查询：前缀EQ

| 序号 | 错误码 | 错误说明                                           | 页面提示 |
|------|--------|----------------------------------------------------|----------|
| 1    | EQ0001 | 参数错误(包含签名验证失败，格式错误等)             |          |
| 2    | EQ0002 | 服务权限尚未开通（IP校验失败，接口没有开通权限等） |          |
| 3    | EQ0003 | 查询对应的机构信息失败                             |          |
| 4    | EQ0004 | 无客户基本信息                                     |          |
| 5    | EQ0005 | 未查询到欠费信息                                   |          |
| 6    | EQ0006 | 该户号不存在                                       |          |
| 8    | EQ0008 | 缴费号码超过受理期，请至收费单位缴费               |          |
| 9    | EQ0009 | 该用户不支持网上缴费，请联系公共事业单位           |          |
| 10   | EQ0010 | 查询超时                                           |          |
| 11   | EQ0011 | 系统异常（系统异常，其他异常，未知错误）           |          |
|      | EQ0012 | 查询欠费信息异常                                   |          |
|      | EQ0013 | 查询余额异常                                       |          |
|      | EQ0014 | 缴费次数超出上限                                   |          |
|      | EQ0015 | 该业务不支持异地办理，请选择正确的城市             |          |

缴费：前缀EP0（错误立即退款），前缀EP1（对账确认后再选择退款）

例：如返回EP0004，系统异常表示微信可立即退款，EP1004不能立即退款，需要对账后退款。

| 序号 | 错误码 | 错误说明                                                 | 页面提示 |
|------|--------|----------------------------------------------------------|----------|
| 1    | EP0001 | 参数错误(包含签名验证失败，格式错误等)                   |          |
| 2    | EP0002 | 服务权限尚未开通（IP校验失败，接口没有开通权限等）       |          |
| 3    | EP0003 | 查询销账所需核心信息失败（包括查询用户，机构信息失败等） |          |
| 4    | EP0004 | 订单创建失败                                             |          |
| 5    | EP1001 | 系统超时                                                 |          |
| 6    | EP1002 | 订单重复提交                                             |          |
| 7    | EP1003 | 未知错误                                                 |          |
| 8    | EP1004 | 系统异常                                                 |          |
|      | EP1005 | 销账失败                                                 |          |
|      | EP1006 | 订单已失效                                               |          |
|      | EP1007 | 机构与子商户号不匹配                                     |          |

缴费回调错误码定义：前缀ES0（错误立即退款），前缀ES1（对账确认后再选择退款）

例：ES0006其他异常可立即退款，ES1006不能立即退款。具体情况由渠道商来定。s

| 序号 | 错误码 | 错误说明                                                                                                 | 页面提示 |
|------|--------|----------------------------------------------------------------------------------------------------------|----------|
| 1    | ES1001 | 参数错误(包含签名验证失败，格式错误等)                                                                   |          |
| 2    | ES1002 | 服务权限尚未开通（IP校验失败，接口没有开通权限等）                                                       |          |
| 3    | ES1003 | 缴费金额异常（eg：缴费金额不足）                                                                         |          |
| 4    | ES1004 | 查询欠费金额与输入充值金额不匹配                                                                         |          |
| 5    | ES1005 | 充值超时                                                                                                 |          |
| 6    | ES1006 | 其他异常                                                                                                 |          |
| 7    | ES1007 | 缺货（针对固定面额的情形）                                                                               |          |
| 8    | ES1008 | 销帐失败                                                                                                 |          |
| 9    | ES1009 | 订单不存在                                                                                               |          |
| 10   | ES1010 | 销账中                                                                                                   |          |
|      | ES1011 | 请按账期顺序依次缴纳（第三方商户可能会控制客户缴费的顺序，比如上一期账单未缴纳情况下最新一期的无法缴纳） |          |
|      | ES1012 | 缴费档次选择错误（主要是套餐类缴费，例如社s保一档客户在选择缴费时选择了二档）                            |          |

代扣查询错误码：前缀ER

| 序号 | 错误码 | 错误说明                  | 页面提示 |
|------|--------|---------------------------|----------|
| 1    | ER0001 | 报文错误(包含MAC验证错误) |          |
| 2    | ER0002 | IP校验失败                |          |
| 3    | ER0003 | 查询对应的机构信息失败    |          |
| 4    | ER0004 | 无客户基本信息            |          |
| 5    | ER0005 | 该用户不支持委托代扣签约  |          |
| 6    | ER0006 | 处理超时                  |          |
| 7    | ER0007 | 未知错误                  |          |
|      |        |                           |          |

签约错误码：前缀EG

| 序号 | 错误码 | 错误说明                  | 页面提示 |
|------|--------|---------------------------|----------|
| 1    | EG0001 | 报文错误(包含MAC验证错误) |          |
| 2    | EG0002 | IP校验失败                |          |
| 3    | EG0003 | 查询对应的机构信息失败    |          |
| 4    | EG0004 | 无客户基本信息            |          |
| 5    | EG0005 | 该用户不支持委托代扣签约  |          |
| 6    | EG0006 | 处理超时                  |          |
| 7    | EG0007 | 未知错误                  |          |
|      |        |                           |          |

解约错误码：前缀EU

| 序号 | 错误码 | 错误说明                  | 页面提示 |
|------|--------|---------------------------|----------|
| 1    | EU0001 | 报文错误(包含MAC验证错误) |          |
| 2    | EU0002 | IP校验失败                |          |
| 3    | EU0003 | 查询对应的机构信息失败    |          |
| 4    | EU0004 | 无客户基本信息            |          |
| 5    | EU0005 | 无客户签约信息            |          |
| 6    | EU0006 | 处理超时                  |          |
| 7    | EU0007 | 未知错误                  |          |
|      |        |                           |          |

代扣配置错误码：前缀ET

| 序号 | 错误码 | 错误说明                  | 页面提示 |
|------|--------|---------------------------|----------|
| 1    | ET0001 | 报文错误(包含MAC验证错误) |          |
| 2    | ET0002 | IP校验失败                |          |
| 3    | ET0003 | 查询对应的机构信息失败    |          |
| 4    | ET0004 | 无客户基本信息            |          |
| 5    | ET0005 | 无客户签约信息            |          |
| 6    | ET0006 | 处理超时                  |          |
| 7    | ET0007 | 未知错误                  |          |
|      |        |                           |          |

银行渠道断直连退款：前缀EBR

| 序号 | 错误码  | 错误说明                               | 页面提示 |
|------|---------|----------------------------------------|----------|
| 1    | EBR0001 | 参数错误(包含签名验证失败，格式错误等) |          |
| 2    | EBR0002 | 获取订单信息失败                       |          |
| 3    | EBR0003 | 退款失败                               |          |
| 4    | EBR0004 | 获取渠道信息失败                       |          |
| 5    | EBR0005 | 订单状态不合法                         |          |
| 6    | EBR0006 | 更新订单状态失败                       |          |

业务类型列表
============

业务类型列表：

| 序号 | 业务类型ID | 业务类型名称 | 备注 |
|------|------------|--------------|------|
| 1    | 1          | 水费         |      |
| 2    | 2          | 电费         |      |
| 3    | 3          | 燃气费       |      |
| 4    | 4          | 宽带费       |      |
| 5    | 5          | 固话费       |      |
| 6    | 6          | 油卡充值     |      |
| 7    | 7          | 违章代办     |      |
| 8    | 8          | 有线电视费   |      |

接入流程
========

渠道商可参考如下流程接入生活缴费。

1.  通信方式评估

支持公网和专线通信接入方式。是否拉取专线由渠道商评估后确定。

拉取专线后，如果渠道商需要，可以将微信支付对账单推送给到渠道商指定的FTP服务器。

接口开发
--------

渠道方需按照生活缴费接口api进行开发接入，包括账单查询接口，销帐发起接口，销帐回调逻辑和销帐结果查询接口。（参见第三章交易接口说明）

开发完成后需，提供**账单查询接口**，**销帐发起接口**和**销帐结果查询接口**url在门户上进行配置。

提供渠道及缴费单位配置信息
--------------------------

由渠道方在门户中自助进行配置，渠道信息包括：

| 提供信息        | 是否必须提供 | 备注                                                                                                   |
|-----------------|--------------|--------------------------------------------------------------------------------------------------------|
| 渠道名称        | 是           | 用户缴费成功后，缴费通知                                                                               |
| 缴费单查询url   | 是           | 查询用户账单信息接口                                                                                   |
| 销帐请求url     | 是           | 用户缴费后由微信侧向渠道方发起销帐接口                                                                 |
| 销帐结果查询url | 否           | 渠道方可额外提供销帐结果查询接口，当销帐通知数据丢包的时由微信侧调用对销帐结果进行确认，提升销帐成功率 |
| 商户号          | 是           | 承载渠道方缴费结算的微信支付商户号                                                                     |
| 商户支付密钥    | 是           | 由微信支付提供商户支付密钥                                                                             |
| 渠道通信密钥    | 是           | 通信签名密钥，由渠道方提供                                                                             |

缴费单位信息：

| 缴费单位信息     | 必须提供 | 备注                                            |
|------------------|----------|-------------------------------------------------|
| 缴费单位名称     | 是       | 例：深圳市电费                                  |
| 缴费单位所属区域 | 是       | 例:广东省深圳市                                 |
| 缴费时间段       | 是       | 业务缴费时段，如凌晨00：10点到23：55分          |
| 缴费提示信息     | 是       | 缴费页面提示信息                                |
| 用户号长度       | 是       | 用于缴费时对用户输入进行校验，如支持6-8位用户号 |

门户入口：<https://payapp.weixin.qq.com/lifepayportal/index.php/clifepay_portal/home>

帐号由微信生活缴费分配

接口自助调试
------------

微信生活缴费提供了接口在线自助联调工具，方便渠道商进行接口调试，入口如下：

<https://payapp.weixin.qq.com/lifepayportal/index.php/clifepay_portal/home#/maintain/query_port/startup>

![](media/89b665712fb52793570d642d9cf901c8.png)

在门户中配置渠道相关信息之后即可进行自助接口调试，方便单接口功能及性能测试。

测试环境接口联调
----------------

通过联调工具调试完成之后，通知微信生活缴费后即可在测试环境下进行整体接口联调。

测试环境入口：

| https://payapp.weixin.qq.com/sandbox/life/index?sandbox=true&disablemod=true |
|------------------------------------------------------------------------------|


微信生活缴费测试环境账单详情通知接口url：

| https://payapp.weixin.qq.com/sandbox/life/callback/queryresult |
|----------------------------------------------------------------|


微信生活缴费测试环境缴费结果通知接口url：

| https://payapp.weixin.qq.com/sandbox/life/callback/chargeresult |
|-----------------------------------------------------------------|


微信生活缴费测试环境申请退款接口（银行渠道断直连专用）url：
-----------------------------------------------------------

| https://payapp.weixin.qq.com/sandbox/life/callback/bankrefund |
|---------------------------------------------------------------|


沙箱环境测试
------------

沙箱环境是一个与正式环境相同配置的对渠道方开放的一个验证环境，渠道方可在沙箱环境下进行缴费测试验证。（沙箱环境等同正式环境配置，唯一区别没有放开公共入口，可通过如下url进行访问）

生活缴费沙箱环境入口url（需在微信客户端打开）:

| https://payapp.weixin.qq.com/life/index?sandbox=true |
|------------------------------------------------------|


微信生活缴费沙箱环境账单详情通知接口url：（与正式环境相同）

| https://payapp.weixin.qq.com/life/callback/queryresult |
|--------------------------------------------------------|


微信生活缴费沙箱环境缴费结果通知接口url：（与正式环境相同）

| https://payapp.weixin.qq.com/life/callback/chargeresult |
|---------------------------------------------------------|


微信生活缴费沙箱环境申请退款接口（银行渠道断直连专用）url：（与正式环境相同）

| https://payapp.weixin.qq.com/life/callback/bankrefund |
|-------------------------------------------------------|


通知上线
--------

渠道方测试完成之后，可通知微信侧申请上线，由微信侧放开正式缴费入口。

对账结算
--------

渠道方可在商户平台通过对账单下载api进行账单下载，由渠道方自行进行对账结算。

对账单下载说明文档：

https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=9_6

退款
----

交易过程中，用户已支付且销帐未成功需对用户进行退款。

退款类型

-   实时退款

对明确销帐失败可实时退款场景与渠道方约定好错误返回码，微信侧识别返回码之后进行实时退款。实时退款也可由渠道方发起，但需将退款结果告知微信侧。

-   T+1退款

对状态未明的情形，渠道方对账确认之后由渠道方或者微信侧发起退款。

微信支付公共退款接口说明：

https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=9_4

验收流程
========

业务上线前需对缴费流程及异常情况进行测试、验收通过后才能上线。业务上线可通过以下方式进行：

| **测试环境——\> 沙箱环境 ——\>正式环境** |
|----------------------------------------|


8.1、接口验证及测试环境联调
---------------------------

1.  销帐查询接口验证

2.  销帐发起接口验证

3.  销帐回调接口验证

4.  销帐结果查询接口验证（如果渠道支持该接口）

以上接口的正常流程和机构约定的异常返回码流程全部覆盖之后方能上线。

8.2、沙箱环境验证
-----------------

在测试环境接口验证通过之后可发到沙箱环境进行测试验证，沙箱环境下配置好线上正式缴费单位的配置，如在沙箱环境下验证无误，再到正式环境放开入口。沙箱环境验证期间需关注整个业务流程是否正常、退款以及结算是否正常。

8.3、正式环境上线
-----------------

沙箱环境灰度验证之后，线上环境再放开入口。
